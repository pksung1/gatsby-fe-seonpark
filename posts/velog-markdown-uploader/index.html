<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.88b42845a6112349ff0a.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=The+Nautigal:wght@400;700&display=swap);@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}code,kbd,samp{font-family:monospace,monospace;font-size:1em}img{border-style:none}button,input,optgroup,select,textarea{line-height:1.15}button,input{overflow:visible}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]::-webkit-search-decoration{-webkit-appearance:none}details{display:block}

/*
! tailwindcss v3.0.8 | MIT License | https://tailwindcss.com
*/*,:after,:before{border:0 solid;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-border-opacity:1;--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);--tw-filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);border-color:rgb(229 231 235/var(--tw-border-opacity))}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.left-0{left:0}.top-12{top:3rem}.top-0{top:0}.z-20{z-index:20}.z-10{z-index:10}.z-0{z-index:0}.m-auto{margin:auto}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-bottom:.5rem;margin-top:.5rem}.mr-1{margin-right:.25rem}.mb-4{margin-bottom:1rem}.-mt-8{margin-top:-2rem}.mt-8{margin-top:2rem}.inline-block{display:inline-block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-32{height:8rem}.h-12{height:3rem}.h-screen{height:100vh}.h-full{height:100%}.w-full{width:100%}.w-48{width:12rem}.w-10\/12{width:83.333333%}.w-screen{width:100vw}.max-w-2xl{max-width:42rem}.flex-1{flex:1 1 0%}.translate-x-2{--tw-translate-x:0.5rem;transform:var(--tw-transform)}.translate-x-4{--tw-translate-x:1rem;transform:var(--tw-transform)}.translate-x-6{--tw-translate-x:1.5rem;transform:var(--tw-transform)}.cursor-pointer{cursor:pointer}.resize{resize:both}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-rows-3{grid-template-rows:repeat(3,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.gap-3{gap:.75rem}.gap-2{gap:.5rem}.gap-8{gap:2rem}.overflow-hidden{overflow:hidden}.rounded{border-radius:.25rem}.rounded-xl{border-radius:.75rem}.rounded-3xl{border-radius:1.5rem}.rounded-t-3xl{border-top-left-radius:1.5rem;border-top-right-radius:1.5rem}.border{border-width:1px}.border-l-8{border-left-width:8px}.border-l-2{border-left-width:2px}.border-red-800{--tw-border-opacity:1;border-color:rgb(153 27 27/var(--tw-border-opacity))}.border-gray-100{--tw-border-opacity:1;border-color:rgb(243 244 246/var(--tw-border-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity))}.p-4{padding:1rem}.p-8{padding:2rem}.py-0\.5{padding-bottom:.125rem;padding-top:.125rem}.px-1{padding-left:.25rem;padding-right:.25rem}.py-0{padding-bottom:0;padding-top:0}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-4{padding-bottom:1rem;padding-top:1rem}.px-4{padding-left:1rem;padding-right:1rem}.pl-2{padding-left:.5rem}.pt-12{padding-top:3rem}.pb-12{padding-bottom:3rem}.pb-4{padding-bottom:1rem}.pt-screen{padding-top:100vh}.text-center{text-align:center}.font-title{font-family:The Nautigal,Noto Sans,sans-serif}.text-sm{font-size:.875rem;line-height:1.25rem}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity))}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.shadow-sm{--tw-shadow:0 1px 2px 0 rgba(0,0,0,.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color)}.shadow-lg,.shadow-sm{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.filter{filter:var(--tw-filter)}.transition-transform{transition-duration:.15s;transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-shadow{transition-duration:.15s;transition-property:box-shadow;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-2xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:"Noto Sans KR",Montserrat,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Noto Sans KR","Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}html{font-family:var(--fontFamily-sans)}#article-body hr{background:var(--color-accent);border:0;height:1px}#article-body h1,#article-body h2,#article-body h3,#article-body h4,#article-body h5,#article-body h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-tight);margin-bottom:var(--spacing-6);margin-top:var(--spacing-12)}#article-body h2,#article-body h3,#article-body h4,#article-body h5,#article-body h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}#article-body h1{color:var(--color-heading-black);font-size:var(--fontSize-5);font-weight:var(--fontWeight-bold)}#article-body h2{font-size:var(--fontSize-4)}#article-body h3{font-size:var(--fontSize-3)}#article-body h4{font-size:var(--fontSize-2)}#article-body h5{font-size:var(--fontSize-1)}#article-body h6{font-size:var(--fontSize-0)}#article-body h1>a,#article-body h2>a,#article-body h3>a,#article-body h4>a,#article-body h5>a,#article-body h6>a{color:inherit;text-decoration:none}#article-body p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0);padding:var(--spacing-0)}#article-body ol,#article-body ul{list-style-image:none;list-style-position:outside;margin-bottom:var(--spacing-8);margin-left:var(--spacing-0);margin-right:var(--spacing-0);padding:var(--spacing-0)}#article-body ol li,#article-body ul li{margin-bottom:calc(var(--spacing-8)/2);padding-left:var(--spacing-0)}#article-body ul li:not(.task-list-item):before{content:"-";margin-right:var(--spacing-2)}#article-body li>p{margin-bottom:calc(var(--spacing-8)/2)}#article-body li :last-child{margin-bottom:var(--spacing-0)}#article-body li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}#article-body blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6)}#article-body blockquote>:last-child{margin-bottom:var(--spacing-0)}#article-body blockquote>ol,#article-body blockquote>ul{list-style-position:inside}#article-body table{border-collapse:collapse;border-spacing:.25rem;margin-bottom:var(--spacing-8);width:100%}#article-body table thead tr th{border-bottom:1px solid var(--color-accent)}.hover\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.group:hover .group-hover\:translate-x-0{--tw-translate-x:0px;transform:var(--tw-transform)}@media (min-width:1024px){.lg\:flex{display:flex}.lg\:grid{display:grid}.lg\:hidden{display:none}.lg\:px-20{padding-left:5rem;padding-right:5rem}}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#b3d4fc;text-shadow:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 4.4.0"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="alternate" type="application/rss+xml" title="Gatsby Starter Blog RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">여기 블로그 글 마크다운으로 변환하여 velog에 올릴수 있도록하기 (1) | Devseon Blogs</title><meta data-react-helmet="true" name="description" content="당일치기 개발하기"/><meta data-react-helmet="true" property="og:title" content="여기 블로그 글 마크다운으로 변환하여 velog에 올릴수 있도록하기 (1)"/><meta data-react-helmet="true" property="og:description" content="당일치기 개발하기"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content=""/><meta data-react-helmet="true" name="twitter:title" content="여기 블로그 글 마크다운으로 변환하여 velog에 올릴수 있도록하기 (1)"/><meta data-react-helmet="true" name="twitter:description" content="당일치기 개발하기"/><link as="script" rel="preload" href="/webpack-runtime-c33989980e904b0e1475.js"/><link as="script" rel="preload" href="/framework-b9923b3cceb493977198.js"/><link as="script" rel="preload" href="/app-c706f84220ca5b9557d2.js"/><link as="script" rel="preload" href="/1943edf48358ec375759a10206b57d36c98a5e6d-de018cd579bb3c705aef.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-011d9d74cf4ef7eb2132.js"/><link as="fetch" rel="preload" href="/page-data/posts/velog-markdown-uploader/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2841359383.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3257411868.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div data-is-root-path="false"><header class="shadow-md w-full h-12 items-center z-20 fixed bg-white"><div class="flex flex-row justify-between px-4 py-2"><h1 class="text-xl font-title"><a href="/">Devseon Blogs</a></h1><div class="flex items-center"><div class="flex flex-row justify-center items-center gap-4 hidden lg:flex"><a href="/posts">Posts</a><a href="/archive">Archive</a><a href="/category">Category</a><a href="/about">About</a></div><div class="lg:hidden flex items-center"><svg version="1.1" baseProfile="full" width="35" height="25" class="overflow-hidden group"><rect width="35" height="2" fill="#000" rx="5" ry="5" class="group-hover:translate-x-0 translate-x-2 transition-transform duration-300"></rect><rect width="35" height="2" y="10" fill="#000" rx="5" ry="5" class="group-hover:translate-x-0 translate-x-4 transition-transform duration-300"></rect><rect width="35" height="2" y="20" fill="#000" rx="5" ry="5" class="group-hover:translate-x-0 translate-x-6 transition-transform duration-300"></rect></svg><div class="flex flex-col items-center absolute left-0 top-12 bg-white w-full shadow hidden"><a class="py-2 w-full shadow text-center" href="/posts">Posts</a><a class="py-2 w-full shadow text-center" href="/archive">Archive</a><a class="py-2 w-full shadow text-center" href="/category">Category</a><a class="py-2 w-full shadow text-center" href="/about">About</a></div></div></div></div></header><main class="flex flex-column"><section class="flex"></section><section class="flex-1 overflow-hidden relative pt-12"><article class="blog-post mx-auto mt-8 p-4 rounded max-w-2xl shadow-lg" itemscope="" itemType="http://schema.org/Article"><header class="py-2"><h1 itemProp="headline" class="text-3xl">여기 블로그 글 마크다운으로 변환하여 velog에 올릴수 있도록하기 (1)</h1><p>February 01, 2022</p></header><hr/><section itemProp="articleBody" id="article-body"><p>여기있는글을 벨로그로 옮기고싶다. 라는 목표로 개발시작</p>
<h2>기능목표</h2>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> 적절한 옵션 보여주기
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> -d [폴더경로] : 게시물이 있는 폴더경로</li>
<li class="task-list-item"><input type="checkbox" disabled> -g [구글키] : 구글 API 키, 이곳에 모든 이미지를 업로드함</li>
<li class="task-list-item"><input type="checkbox" disabled> -o [결과물 폴더] : 결과물들을 저장할 폴더 지정</li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox" disabled> 폴더에 올릴 파일 가져오기</li>
<li class="task-list-item"><input type="checkbox" disabled> <del>구글드라이브에 이미지파일 올리기</del> aws에 파일올리기</li>
<li class="task-list-item"><input type="checkbox" disabled> 마크다운 글을 <del>드라이브</del> S3에 올린 이미지링크로 변환하기</li>
<li class="task-list-item"><input type="checkbox" disabled> 벨로그에 올려보기</li>
</ul>
<p>개발시작</p>
<h2>1. 환경 세팅</h2>
<ul>
<li>Typescript로 개발하기 위해 구성</li>
</ul>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn add -D ts-node nodemon typescript</code></pre></div>
<ul>
<li>tsconfig.json 구성</li>
</ul>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span><span class="token punctuation">,</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"allowSyntheticDefaultImports"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es6"</span><span class="token punctuation">,</span>
    <span class="token property">"noImplicitAny"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"outDir"</span><span class="token operator">:</span> <span class="token string">"dist"</span><span class="token punctuation">,</span>
    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"*"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"node_modules/*"</span><span class="token punctuation">,</span>
        <span class="token string">"src/types/*"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"src/**/*"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<ul>
<li>src 폴더에 app.ts 생성</li>
<li>package.json 에 scripts 추가</li>
</ul>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"nodemon src/app.ts"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<h2>2. <a href="https://github.com/tj/commander.js">commander</a> - CommandLine interface 를 위하여</h2>
<p>nodejs 프로그램에 args 옵션을 보여줄수 있는 라이브러리다.</p>
<p>예제코드</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> program <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'--first'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-s, --separator &lt;char>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> program<span class="token punctuation">.</span><span class="token function">opts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> limit <span class="token operator">=</span> options<span class="token punctuation">.</span>first <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>program<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>separator<span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>예제코드를 활용해 아래와 같이 구성했다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span>program<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'commander'</span>

<span class="token keyword">type</span> <span class="token class-name">Options</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  outDir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  googleKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> options<span class="token operator">:</span> Options <span class="token operator">=</span> <span class="token punctuation">{</span>
  dir<span class="token operator">:</span> <span class="token string">'./'</span><span class="token punctuation">,</span>
  outDir<span class="token operator">:</span> <span class="token string">'./output'</span><span class="token punctuation">,</span>
  googleKey<span class="token operator">:</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>

program
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d, --dir &lt;string>'</span><span class="token punctuation">,</span> <span class="token string">'검색할 폴더입니다. md 파일과 이미지파일을 읽어들입니다.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-o, --outDir &lt;string>'</span><span class="token punctuation">,</span> <span class="token string">'결과를 보여줄 폴더입니다.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-g, --googleKey &lt;string>'</span><span class="token punctuation">,</span> <span class="token string">'업로드를 위해 구글 키가 필요합니다.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> programOptions <span class="token operator">=</span> program<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">opts</span><span class="token generic class-name"><span class="token operator">&lt;</span>Options<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>programOptions<span class="token punctuation">.</span>googleKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Google key가 없습니다.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> programOptions<span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>dir<span class="token punctuation">,</span> options<span class="token punctuation">.</span>outDir<span class="token punctuation">,</span> options<span class="token punctuation">.</span>googleKey<span class="token punctuation">)</span>  
<span class="token punctuation">}</span>
</code></pre></div>
<ul>
<li>-d, —dir 로 검사할 폴더를 선택</li>
<li>-o, —outDir 로 결과를 볼 폴더 선택</li>
<li>-g, —googleKey 로 구글업로드를 위한 키를 받는다</li>
</ul>
<p>그러면 적절한 옵션 보여주기는 어느정도 마무리된것같으니 다음 스텝을 진행한다.</p>
<hr>
<h2>검사할 폴더 내 md 파일, 이미지파일 읽기</h2>
<p>md파일과 이미지파일을 어떻게 읽어야할까?</p>
<p>nodejs에는 fs와 os로 파일을 읽고 폴더내용들을 볼수 있는 방법이 있다.</p>
<h2>markdown, 이미지 경로 분리해서 보여주기</h2>
<p>함수기능을 구현해야 하기 떄문에 utils.ts 를 새로 생성헀다.</p>
<p>단순하게 dir이 실행됬을떄 path를 찾을수 있도록 구현했다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token comment">/**
 * @param dir 검색할 폴더 위치
 */</span>
<span class="token keyword">function</span> <span class="token function">getFiles</span> <span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
  getFiles
<span class="token punctuation">}</span></code></pre></div>
<ul>
<li>process.cwd()는 process실행위치를 가져온다.</li>
</ul>
<p>현재 폴더 위치에서 가져와야할 md, png 파일들은 어떻게 알수 있을까?</p>
<p>nodejs에는 os모듈이 있다. os모듈로 grep같은 명령어를 실행할수 있기 때문에
파일목록들을 가져올수 있을거라 생각했다.</p>
<p>내가 원하는 형태의 파일만 가져오기 위해서 떠오른건 regex고, 이를 활용해 가져올수있었다.</p>
<p>readdir(dir) 로 폴더 내용물들을 볼수 있는데 depth를 깊게 들어갈 수 없었다.</p>
<p>재귀를 이용해 내부까지 순회하는 코드를 작성했다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs/promises'</span>

<span class="token comment">/**
 * @param dir 검색할 폴더 위치
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getFiles</span> <span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> targetDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_recursiveFindFiles</span><span class="token punctuation">(</span>targetDir<span class="token punctuation">)</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> filenameRegex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[.png|.md]$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 
 * @param dir 폴더위치
 * @returns 폴더 위치에서부터 내부 depth로 들어가 찾은 모든 파일들을 filenameRegex 필터링한값
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_recursiveFindFiles</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">// 폴더의 파일목록을 불러옴</span>
  <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> result<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  
  <span class="token comment">// 불러온 파일들 순회</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> file <span class="token keyword">of</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> file<span class="token punctuation">)</span>

    <span class="token comment">// 파일의 정보를 가져온다.</span>
    <span class="token keyword">const</span> stat <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>

    <span class="token comment">// 파일이 폴더라면 내부 순회를 시작한다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> childResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_recursiveFindFiles</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
      <span class="token comment">// childResult와 result를 병합한다.</span>
      result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>result<span class="token punctuation">,</span> <span class="token operator">...</span>childResult<span class="token punctuation">]</span>

      <span class="token comment">// 파일이름에 .png, .md가 들어가있다면 결과에 경로를 추가한다.</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>filenameRegex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>
  getFiles
<span class="token punctuation">}</span></code></pre></div>
<p>원하는 결과를 얻을수 있었다.</p>
<p><img src="https://velog-upload-bucket.s3.ap-northeast-2.amazonaws.com/content/blog/velog-markdown-uploader/result-find-files.png" alt="result-find-files"></p>
<h2>구글드라이브에 파일 올리기</h2>
<p>구글드라이브에 글을 올리기 전에 velog에서 구글드라이브글을 직접 올려보았다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">교차 출처 읽기 차단(CORB)으로 MIME 유형이 text/html인 교차 출처 응답(https://drive.google.com/file/d/.../view?usp=sharing)이 차단되었습니다. 자세한 내용은 https://www.chromestatus.com/feature/5629709824032768을 참고하세요.</code></pre></div>
<p>맞다 CORS..</p>
<p>어쩔수 없다 다른방법을 강구해보기로 했다.</p>
<p>AWS S3는 CORS를 풀수있다.</p>
<p>비용이 걱정이니 한번 비용을 찾아보기로 했다.</p>
<h2>AWS S3 비용</h2>
<h3>요청에 관한비용</h3>
<p><img src="https://velog-upload-bucket.s3.ap-northeast-2.amazonaws.com/content/blog/velog-markdown-uploader/aws-request-pay.png" alt="aws-request-pay.png"></p>
<p>GET 1000번 요청당 0.00035 달러 => 0.42 대한민국 원</p>
<p>만명만 들어와도 4.2원..? 매우싸다</p>
<h3>저장에 관한 비용</h3>
<p>50GB - 0.025 USD => 30.10 대한민국 원</p>
<p>이것 또한 천원도 안한다</p>
<h3>전송에 관한 비용</h3>
<p><img src="https://velog-upload-bucket.s3.ap-northeast-2.amazonaws.com/content/blog/velog-markdown-uploader/aws-network-pay.png" alt="aws-network-pay.png"></p>
<ul>
<li>처음 10TB/월	GB당 0.126 USD => 151.71 대한민국 원</li>
</ul>
<p>다해서 한달에 200원..?
안쓸 이유가 없다. AWS로 전환하기로 마음먹고 진행한다.</p>
<h2>AWS S3 연결하기</h2>
<p><a href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/s3-node-examples.html">https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/s3-node-examples.html</a></p>
<p>aws-sdk를 설치한다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">yarn add aws-sdk</code></pre></div>
<p>문서에서 사용자 인증이 필요하다고 써있다.</p>
<p>인증을 추가해보자</p>
<p><a href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/loading-node-credentials-shared.html">https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/loading-node-credentials-shared.html</a></p>
<p>aws console에 접속해서 내 닉네임 - 보안자격증명 - 사용자 에서 사용자를 추가한다.</p>
<p>추가할때 s3 권한을 준다.</p>
<p>그후 생긴 aws_access_key, aws_secret_access_key를 ~/.aws/credential 을 생성한다.</p>
<p>위의 링크대로 작성하고 저장한다.</p>
<p>나는 이름을 velog-uploader로 지정했다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token constant">AWS</span> <span class="token keyword">from</span> <span class="token string">'aws-sdk'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">AWS</span></span><span class="token punctuation">.</span><span class="token function">SharedIniFileCredentials</span><span class="token punctuation">(</span><span class="token punctuation">{</span>profile<span class="token operator">:</span> <span class="token string">'velog-uploader'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials <span class="token operator">=</span> credentials<span class="token punctuation">;</span>
<span class="token comment">// 서울 설정</span>
<span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>region<span class="token operator">:</span> <span class="token string">'ap-northeast-2'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token keyword">const</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">AWS</span></span><span class="token punctuation">.</span><span class="token constant">S3</span><span class="token punctuation">(</span><span class="token punctuation">{</span>apiVersion<span class="token operator">:</span> <span class="token string">'2022-02-01'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

s3<span class="token punctuation">.</span><span class="token function">listBuckets</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Error"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Success"</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>Buckets<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span>s3<span class="token punctuation">}</span></code></pre></div>
<p>Success가 나온다면 정상적으로 연결된것이다.</p>
<p>연결이 된걸 확인했으니 이제 버킷을 생성해볼 차례다.</p>
<h2>AWS S3 버킷 생성하기</h2>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">s3<span class="token punctuation">.</span><span class="token function">createBucket</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Bucket<span class="token operator">:</span> <span class="token string">'velog-upload-bucket'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Error"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Success"</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>Location<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>velog-upload-bucket을 생성했고 <a href="http://velog-upload-bucket.s3.amazonaws.com/">http://velog-upload-bucket.s3.amazonaws.com/</a> 로 접속할수 있게 되었다.</p>
<p>만약 한번더 실행한다면?</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Your previous request to create the named bucket succeeded and you already own it.</code></pre></div>
<p>위와같은 오류가 나며 실행되지 않는다.</p>
<p>파일을 올릴 차례전, 생각을 해봐야하는건 중복파일에 관해 고민해봐야 할것같다.</p>
<p>업로드할 파일들을 어떻게 해야 중복하지 않고 올릴수 있을까?</p>
<p>다시말하면 꼭 필요한 파일만 올릴수 있는 방법이 없을까?</p>
<p>생각나는 방법은 아래와 같았다.</p>
<ul>
<li>uuid, 유니크 아이디를 만들어낸다. but 시점마다 다르기 때문에 out</li>
<li>파일 암호화하기. filePath는 모두 다르므로 암호화해서 올린다.</li>
<li>그냥 filepath로 올리기</li>
</ul>
<p>그냥 세번째로 해도 될것같다. 대신 이름의 시작은 처음에 입력받은 dir로 하자.</p>
<h2>업로드할 파일명 만들기</h2>
<p>파일경로는 무조건 처음에 입력받은 dir이 포함되어 있기 떄문에</p>
<p>아래와 같은 형태일것이다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">.../dir/~~~~.png</code></pre></div>
<p>indexOf로 dir을 찾고 filename.length 까지 끊어주면 될것같다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">getFileName</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> filename<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>아 젠장 dir이 ../content인 경우가 있다.</p>
<p>path.basename()으로 dir을 감싸 content만 떼어온다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">getFileName</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> filename<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> filename<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filename<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>결과로 이렇게 불러올수있었다.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    filepath<span class="token operator">:</span> '<span class="token punctuation">[</span>projectDir<span class="token punctuation">]</span>/content/TIL/<span class="token number">20220126</span>/index.md'<span class="token punctuation">,</span>
    s3Name<span class="token operator">:</span> 'content/TIL/<span class="token number">20220126</span>/index.md'
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    filepath<span class="token operator">:</span> '<span class="token punctuation">[</span>projectDir<span class="token punctuation">]</span>/gatsby-starter-blog/content/TIL/<span class="token number">20220126</span>/kotlin-databinding.png'<span class="token punctuation">,</span>
    s3Name<span class="token operator">:</span> 'content/TIL/<span class="token number">20220126</span>/kotlin-databinding.png'
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    filepath<span class="token operator">:</span> '<span class="token punctuation">[</span>projectDir<span class="token punctuation">]</span>/gatsby-starter-blog/content/TIL/<span class="token number">20220130</span>/index.md'<span class="token punctuation">,</span>
    s3Name<span class="token operator">:</span> 'content/TIL/<span class="token number">20220130</span>/index.md'
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre></div>
<p>아 이미지만 업로드할거다.
지금 md파일과 이미지파일을 분리할 필요가 있다.</p>
<p>_recursiveFindFiles에서 한번 파일루프를 돌기 때문에 이 함수에서 처리해주는게 맞는것같다.</p>
<p>이런 리팩토링에 타입스크립트로 작성한 장점이 나온다.</p>
<p>interface 하나를 선언한다</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">IFileFindResult</span> <span class="token punctuation">{</span>
  md<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  img<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>_recursiveFindFiles 함수에 리턴타입을 준다</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_recursiveFindFiles</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>IFileFindResult<span class="token operator">></span> <span class="token punctuation">{</span></code></pre></div>
<p>그러면 뭘 수정해야하는지 알려주는게 좋은것같다.</p>
<p><img src="https://velog-upload-bucket.s3.ap-northeast-2.amazonaws.com/content/blog/velog-markdown-uploader/good-typescript.png" alt="thanks-typescript"></p>
<p>_recursiveFindFiles를 새롭게 수정했다.
이제 md와 이미지를 분리하여 가져올수 있게 되었다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">
<span class="token keyword">interface</span> <span class="token class-name">IFileFindResult</span> <span class="token punctuation">{</span>
  md<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  img<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 
 * @param dir 폴더위치
 * @returns 폴더 위치에서부터 내부 depth로 들어가 찾은 모든 파일들을 filenameRegex 필터링한값
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">_recursiveFindFiles</span><span class="token punctuation">(</span>dir<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>IFileFindResult<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token comment">// 폴더의 파일목록을 불러옴</span>
  <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> result<span class="token operator">:</span> IFileFindResult <span class="token operator">=</span> <span class="token punctuation">{</span>
    md<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    img<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 불러온 파일들 순회</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> file <span class="token keyword">of</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> file<span class="token punctuation">)</span>

    <span class="token comment">// 파일의 정보를 가져온다.</span>
    <span class="token keyword">const</span> stat <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>

    <span class="token comment">// 파일이 폴더라면 내부 순회를 시작한다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> childResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">_recursiveFindFiles</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
      <span class="token comment">// childResult와 result를 병합한다.</span>
      result <span class="token operator">=</span> <span class="token punctuation">{</span>
        md<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>result<span class="token punctuation">.</span>md<span class="token punctuation">,</span> <span class="token operator">...</span>childResult<span class="token punctuation">.</span>md<span class="token punctuation">]</span><span class="token punctuation">,</span>
        img<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>result<span class="token punctuation">.</span>img<span class="token punctuation">,</span> <span class="token operator">...</span>childResult<span class="token punctuation">.</span>img<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 파일이름에 .png, .md가 들어가있다면 결과에 경로를 추가한다.</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'.md'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span>md<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'.png'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span>img<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>플로우 생각하기</h2>
<p>이제 기능들은 어느정도 구현이 되었다.</p>
<p>플로우를 고민해서 순차적으로 실행되도록 해볼 생각이다.</p>
<ol>
<li>S3 bucket 생성하기</li>
<li>md, 이미지 파일 분리하기</li>
<li>올릴 이미지 파일 이름정하기</li>
<li>이미지 업로드하기</li>
<li>업로드한 이미지 링크로 markdown에 대체하기</li>
<li>대체한 markdown 파일을 output 폴더에 넣기 (index + 파일이름)</li>
<li>velog에 올려보기</li>
</ol>
<p>이 플로우대로 리팩토링을 진행해본다.</p>
<p>진행하면서 찾은건 aws-sdk에서 promise를 지원한다는것이다.</p>
<p><a href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/using-promises.html">https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/using-promises.html</a></p>
<p>괜히 프로미스로 감싸고있었다 ㅎ..</p>
<p>업로드는 연속적으로 되므로 이건.. 수정할 필요가 있을것같다.</p>
<p>이미 업로드된 이미지를 제외한 나머지만 올리는걸로 해서 구현하고싶은데
n개의 이미지배열과 m개의 업로드된 이미지배열을 비교하는건 n*m번 검색할수도 있기 때문에.. 업로드이미지를 hashmap으로 바꾸고 검색하는 방식으로 구현해야 할것같다.</p>
<p>filter의 순수함수를 만들어야 하므로 클로저를 활용했다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">generateUploadImageFilter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> images <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getListObjects</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> searchMap <span class="token operator">=</span> images<span class="token punctuation">.</span>Contents<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">reduce</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">}</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resultImage<span class="token punctuation">,</span> currentImage<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>resultImage<span class="token punctuation">,</span> <span class="token punctuation">[</span>currentImage<span class="token punctuation">.</span>Key<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 필터 클로저함수 </span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>s3Name<span class="token punctuation">}</span><span class="token operator">:</span> UploadImageFilterType<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> searchMap<span class="token punctuation">[</span>s3Name<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>메인 함수는 아래와 같이 구현했다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">start</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// S3 bucket 생성하기</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'S3 bucket 생성하기'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">createBucket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'S3 bucket 생성하기'</span><span class="token punctuation">)</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'md, 이미지 파일 분리하기'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> findFiles <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFileInfos</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>dir<span class="token punctuation">)</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'md, 이미지 파일 분리하기'</span><span class="token punctuation">)</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'Upload 이미지 필터 생성'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> uploadImageFilter <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">generateUploadImageFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'Upload 이미지 필터 생성'</span><span class="token punctuation">)</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'올릴 이미지 파일 이름정하기'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> uploadFiles <span class="token operator">=</span> findFiles<span class="token punctuation">.</span>img
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>filepath <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>filepath<span class="token punctuation">,</span> s3Name<span class="token operator">:</span> <span class="token function">getFileName</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>dir<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>uploadImageFilter<span class="token punctuation">)</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'올릴 이미지 파일 이름정하기'</span><span class="token punctuation">)</span>
  
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uploadFiles<span class="token punctuation">)</span>
  uploadFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>filepath<span class="token punctuation">,</span> s3Name<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>s3Name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 업로드</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> s3Name<span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>s3Name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 업로드</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>순서대로 실행되도록 구성했다.</p>
<p>이제 업로드까지 되는걸 확인했다.</p>
<p>S3에 올린 이미지를 velog에서 잘 볼수있는지 확인해보자.</p>
<p><a href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/cors.html">https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/cors.html</a></p>
<p>velog만 접속 가능하도록 AllowedOrigins를 수정했다.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">"AllowedHeaders"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"*"</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"AllowedMethods"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"GET"</span><span class="token punctuation">,</span>
            <span class="token string">"HEAD"</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"AllowedOrigins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"https://velog.io"</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"ExposeHeaders"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"x-amz-server-side-encryption"</span><span class="token punctuation">,</span>
            <span class="token string">"x-amz-request-id"</span><span class="token punctuation">,</span>
            <span class="token string">"x-amz-id-2"</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"MaxAgeSeconds"</span><span class="token operator">:</span> <span class="token number">3000</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre></div>
<p>버킷정책을 추가한다.
S3로 권한없이 접속하기위해서는 아래와 같이 버킷정책이 필요하다.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>
    <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"Sid"</span><span class="token operator">:</span> <span class="token string">"Statement1"</span><span class="token punctuation">,</span>
            <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
            <span class="token property">"Principal"</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>
            <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token string">"s3:GetObject"</span><span class="token punctuation">,</span>
            <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token string">"arn:aws:s3:::velog-upload-bucket/*"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>s3의 velog-upload-bucket에서 있는 Object들을 모두 접근이 가능하다.</p>
<p><img src="https://velog-upload-bucket.s3.ap-northeast-2.amazonaws.com/content/blog/velog-markdown-uploader/aws-s3-image-velog-upload.png" alt="aws-s3-image-velog-upload"></p>
<p>올라갔다!</p>
<p>이제 S3에 올라간 이미지가 올라가는걸 확인할수 있었다.</p>
<p>다음은 markdown에 있는 이미지 링크들을 다 바꿔야 한다.</p>
<h2>진행상황</h2>
<ul class="contains-task-list">
<li>[v] S3 bucket 생성하기</li>
<li>[v] md, 이미지 파일 분리하기</li>
<li>[v] 올릴 이미지 파일 이름정하기</li>
<li>[v] 이미지 업로드하기</li>
<li class="task-list-item"><input type="checkbox" disabled> 업로드한 이미지 링크로 markdown에 대체하기</li>
<li class="task-list-item"><input type="checkbox" disabled> 대체한 markdown 파일을 output 폴더에 넣기 (index + 파일이름)</li>
<li class="task-list-item"><input type="checkbox" disabled> velog에 올려보기</li>
</ul></section><hr/><footer><div class="flex flex-row items-center justify-center gap-3 py-4"><div data-gatsby-image-wrapper="" style="width:50px;height:50px" class="gatsby-image-wrapper rounded-3xl"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#c8d8e8;width:50px;height:50px;position:relative"></div><picture><source type="image/avif" data-srcset="/static/905c7f416dfb7409be8f6b89f33c6117/d4bf4/profile-pic.avif 50w,/static/905c7f416dfb7409be8f6b89f33c6117/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" data-srcset="/static/905c7f416dfb7409be8f6b89f33c6117/3faea/profile-pic.webp 50w,/static/905c7f416dfb7409be8f6b89f33c6117/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" data-src="/static/905c7f416dfb7409be8f6b89f33c6117/d24ee/profile-pic.jpg" data-srcset="/static/905c7f416dfb7409be8f6b89f33c6117/d24ee/profile-pic.jpg 50w,/static/905c7f416dfb7409be8f6b89f33c6117/64618/profile-pic.jpg 100w" alt="Profile picture"/></picture><noscript><picture><source type="image/avif" srcSet="/static/905c7f416dfb7409be8f6b89f33c6117/d4bf4/profile-pic.avif 50w,/static/905c7f416dfb7409be8f6b89f33c6117/ee81f/profile-pic.avif 100w" sizes="50px"/><source type="image/webp" srcSet="/static/905c7f416dfb7409be8f6b89f33c6117/3faea/profile-pic.webp 50w,/static/905c7f416dfb7409be8f6b89f33c6117/6a679/profile-pic.webp 100w" sizes="50px"/><img data-gatsby-image-ssr="" layout="fixed" data-main-image="" style="opacity:0" sizes="50px" decoding="async" loading="lazy" src="/static/905c7f416dfb7409be8f6b89f33c6117/d24ee/profile-pic.jpg" srcSet="/static/905c7f416dfb7409be8f6b89f33c6117/d24ee/profile-pic.jpg 50w,/static/905c7f416dfb7409be8f6b89f33c6117/64618/profile-pic.jpg 100w" alt="Profile picture"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><p>Written by <strong>Devseon</strong> <!-- -->Frontend developer</p></div></footer></article><nav class="shadow-lg mx-auto my-2 p-4 rounded max-w-2xl"><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/posts/blog-composer-project-02/">← <!-- -->Blog Composer Project (2)</a></li><li></li></ul></nav></section></main><footer></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/velog-markdown-uploader/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b227d9031ab4094e5021.js"],"app":["/app-c706f84220ca5b9557d2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-4b3f8515b0d3683446b1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-54b4d062181e3e9fba5a.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-04dbed761013aaaefa44.js"],"component---src-pages-category-js":["/component---src-pages-category-js-398c1347a52dd11513ee.js"],"component---src-pages-index-js":["/component---src-pages-index-js-8642f7c239aaf43053d8.js"],"component---src-pages-posts-js":["/component---src-pages-posts-js-95fc26368ba5fe71a22f.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-097df78d2557fa8e1240.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-011d9d74cf4ef7eb2132.js"]};/*]]>*/</script><script src="/polyfill-b227d9031ab4094e5021.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-011d9d74cf4ef7eb2132.js" async=""></script><script src="/1943edf48358ec375759a10206b57d36c98a5e6d-de018cd579bb3c705aef.js" async=""></script><script src="/app-c706f84220ca5b9557d2.js" async=""></script><script src="/framework-b9923b3cceb493977198.js" async=""></script><script src="/webpack-runtime-c33989980e904b0e1475.js" async=""></script></body></html>